<!DOCTYPE html>
<html lang="ko">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>ë‹¬ë¬´í‹° ì¼ë³¸ì–´ ìˆ«ì</title>
Â  Â  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
Â  <style>
    /* 1. ë³€ìˆ˜ ë° ì „ì²´ ë°°ê²½ ì„¤ì • */
    :root { 
        --bg-color: #1a252f; 
        --accent: #f1c40f; 
        --card-bg: #ffffff; 
    }
    
    html, body { 
        background-color: #1a252f !important; 
        color: white !important; 
        margin: 0; 
        padding: 0; 
        min-height: 100vh;
        font-family: 'Malgun Gothic', sans-serif;
        text-align: center;
    }

    /* 2. í™”ë©´ ê°€ë¦¬ê¸° ê¸°ëŠ¥ (ì´ê²Œ ì•ˆ ë¨¹íˆë©´ ëŒ€ê¸°ì‹¤ì´ ë¯¸ë¦¬ ë³´ì„) */
    .hidden { display: none !important; }

    /* 3. ë ˆì´ì•„ì›ƒ (ê²€ì€ íŒë„¬) */
    .screen { 
        background: rgba(0, 0, 0, 0.85) !important; 
        padding: 20px; 
        border-radius: 15px; 
        max-width: 500px; 
        margin: 20px auto; 
        border: 1px solid #34495e; 
        box-shadow: 0 8px 30px rgba(0,0,0,0.6);
        display: block; 
    }

    /* 4. ì¹´ë“œ ë””ìì¸ */
    .card-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-top: 15px; min-height: 110px; }
    .card { 
        width: 65px; height: 95px; background: var(--card-bg); border-radius: 8px; 
        border: 2px solid #333; cursor: pointer; display: flex; align-items: center; 
        justify-content: center; color: #2c3e50 !important; font-weight: bold; 
        font-size: 15px; box-shadow: 2px 2px 5px rgba(0,0,0,0.3); transition: transform 0.2s;
        word-break: keep-all;
    }
    .card.selected { transform: translateY(-15px); border: 3px solid #e67e22; background: #fff9e6; }
    .card.disabled { opacity: 0.6; cursor: default; background: #bdc3c7; color: #7f8c8d; }

    /* 5. ì…ë ¥ì°½ ë° ë²„íŠ¼ */
    input { padding: 12px; width: 80%; border-radius: 5px; border: 2px solid #34495e; font-size: 16px; margin-bottom: 10px; text-align: center; background: white; color: black; }
    button { padding: 12px; border-radius: 8px; border: none; background: #e67e22; color: white; font-weight: bold; cursor: pointer; margin: 5px; width: 85%; font-size: 16px; }

    /* 6. ê¸°íƒ€ UI ìš”ì†Œ */
    #status-bar { padding: 10px; margin-bottom: 10px; border-radius: 8px; font-size: 14px; background: #c0392b; font-weight: bold; }
    .online { background: #27ae60 !important; }
    #rank-board { background: rgba(255, 255, 255, 0.1); border-radius: 10px; padding: 10px; margin-bottom: 15px; display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; }
    .rank-badge { padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; background: #34495e; border: 1px solid var(--accent); }
    .turn-msg { font-size: 1.1rem; color: var(--accent); font-weight: bold; margin: 10px 0; }
    .role-item { margin: 8px 0; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); text-align: left; border-left: 4px solid var(--accent); }
    .badge-dalmuti { background: #f1c40f !important; color: #000; }
    .badge-peon { background: #95a5a6 !important; }
    .badge-common { background: #34495e !important; }
</style>
</head>
<body>
Â  Â  <div id="status-bar">ì„œë²„ ì—°ê²° ì¤‘...</div>

Â  Â  <div id="setup" class="screen">
Â  Â  Â  Â  <h2 style="color:var(--accent)">ğŸ° ë‹¬ë¬´í‹°</h2>
Â  Â  Â  Â  <input type="text" id="my-name" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" maxlength="8">
Â  Â  Â  Â  <button onclick="initPeer(true)">ë°© ë§Œë“¤ê¸° (ë°©ì¥)</button>
Â  Â  Â  Â  <hr style="border:0.5px solid #444; margin:15px 0;">
Â  Â  Â  Â  <input type="text" id="join-id" placeholder="ë°© ì½”ë“œê°€ ìë™ ì…ë ¥ë©ë‹ˆë‹¤">
Â  Â  Â  Â  <button onclick="initPeer(false)" style="background:#2980b9;">ë°© ì°¸ì—¬í•˜ê¸°</button>
Â  Â  </div>

Â  Â  <div id="lobby" class="screen hidden">
Â  Â  Â  Â  <h3>ğŸ“¢ ëŒ€ê¸°ì‹¤</h3>
<p>ë°© ì½”ë“œ: <b id="display-room-code" style="color:var(--accent); font-size:1.2rem;">-</b></p>
        <button onclick="copyRoomLink()" style="background:#8e44ad; width:auto; padding:8px 15px;">ğŸ”— ì´ˆëŒ€ ë§í¬ ë³µì‚¬</button>
Â  Â  Â  Â  <div id="player-list-lobby" style="margin: 20px 0;"></div>
Â  Â  Â  Â  <button id="start-btn" onclick="hostStartRoleDraw()" class="hidden">ì„œì—´ ì •í•˜ê¸° ì‹œì‘</button>
Â  Â  </div>

Â  Â  <div id="role-draw" class="screen hidden">
Â  Â  Â  Â  <h3>ğŸƒ ì„œì—´ ì •í•˜ê¸°</h3>
Â  Â  Â  Â  <div id="role-turn-msg" class="turn-msg"></div>
Â  Â  Â  Â  <div id="role-cards" class="card-container"></div>
Â  Â  Â  Â  <div id="role-results" style="margin-top:15px;"></div>
Â  Â  </div>

Â  Â  <div id="tax-phase" class="screen hidden">
Â  Â  Â  Â  <h3>ğŸ’° ì„¸ê¸ˆ ë° í•˜ì‚¬</h3>
Â  Â  Â  Â  <p id="tax-instruction"></p>
Â  Â  Â  Â  <div id="tax-hand" class="card-container"></div>
Â  Â  Â  Â  <p id="tax-msg" style="color:#ff7675; font-weight:bold; margin:10px 0;"></p>
Â  Â  Â  Â  <button id="tax-btn" onclick="submitTax()">ì¹´ë“œ ì „ë‹¬</button>
Â  Â  </div>

Â  Â  <div id="game-board" class="screen hidden">
Â  Â  Â  Â  <div id="rank-board"></div>
Â  Â  Â  Â  <div id="turn-display" class="turn-msg"></div>
Â  Â  Â  Â  <div id="table-cards" class="card-container" style="min-height:120px; background:rgba(255,255,255,0.05); border-radius:10px; padding:10px;"></div>
Â  Â  Â  Â  <div id="my-hand" class="card-container"></div>
Â  Â  Â  Â  <div style="margin-top:15px;">
Â  Â  Â  Â  Â  Â  <button onclick="playCards()">ì¹´ë“œ ë‚´ê¸°</button>
Â  Â  Â  Â  Â  Â  <button onclick="passTurn()" style="background:#7f8c8d;">í†µê³¼ (Pass)</button>
Â  Â  Â  Â  </div>
<div id="round-result-screen" class="screen hidden">
Â  Â  Â  Â  <h2 style="color:var(--accent)">ğŸ† ë¼ìš´ë“œ ì¢…ë£Œ ğŸ†</h2>
Â  Â  Â  Â  <div id="final-ranking-list" style="margin: 20px 0;"></div>
Â  Â  Â  Â  <button onclick="finalizeRoles()" style="background:#2ecc71;">ì´ ì„œì—´ë¡œ ë‹¤ìŒ íŒ ì‹œì‘</button>
Â  Â  Â  Â  <button onclick="location.reload()" style="background:#e74c3c;">ì™„ì „ ìƒˆë¡œ ì‹œì‘(ë°© í­íŒŒ)</button>
Â  Â  </div>
Â  Â  </div>

<script>
Â  Â  let peer, conn, connections = [];
Â  Â  let isHost = false, myID = "", myName = "";
Â  Â  let players = [], currentPlayerIdx = 0, lastPlayed = {rank:14, count:0}, selectedCards = [], passCount = 0;
Â  Â  let taxStorage = [], roleDrawingIdx = 0, roleDeck = [];
Â  Â  let finishOrder = [];

Â  Â  window.onload = () => {
Â  Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  Â  const room = urlParams.get('room');
Â  Â  Â  Â  if (room) document.getElementById('join-id').value = room;
Â  Â  };

Â  Â  function copyRoomLink() {
Â  Â  Â  Â  const link = `${window.location.origin}${window.location.pathname}?room=${myID}`;
Â  Â  Â  Â  navigator.clipboard.writeText(link).then(() => alert("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"));
Â  Â  }

Â  Â  function updateLobby() {
Â  Â  Â  Â  const list = document.getElementById('player-list-lobby');
Â  Â  Â  Â  list.innerHTML = players.map(p => `<div>ğŸ‘¤ ${p.name} ${p.id === myID ? '(ë‚˜)' : ''}</div>`).join('');
Â  Â  Â  Â  if(isHost && players.length >= 2) {
Â  Â  Â  Â  Â  Â  document.getElementById('start-btn').classList.remove('hidden');
Â  Â  Â  Â  }
Â  Â  }
function initPeer(host) {
    myName = document.getElementById('my-name').value.trim();
    if (!myName) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!");
    isHost = host;
    
    peer = new Peer();
    
    peer.on('open', id => {
        myID = id;
        
        // 1. ìƒíƒœ í‘œì‹œì¤„ ì—…ë°ì´íŠ¸
        const statusEl = document.getElementById('status-bar');
        statusEl.innerText = isHost ? "ë°©ì¥ì´ ë˜ì—ˆìŠµë‹ˆë‹¤" : "ì—°ê²°ë¨";
        statusEl.classList.add('online');
        
        // 2. ìƒì„±ëœ ê³ ìœ  IDë¥¼ í™”ë©´ì˜ 'ë°© ì½”ë“œ' ìë¦¬ì— í‘œì‹œ
        const codeDisplay = document.getElementById('display-room-code');
        if (codeDisplay) codeDisplay.innerText = id;

        if(isHost) {
            players = [{id, name:myName, hand:[], isFinished:false}];
            showScreen('lobby'); 
            updateLobby();
        } else {
            const targetID = document.getElementById('join-id').value.trim();
            if(!targetID) return alert("ë°© ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
            
            conn = peer.connect(targetID);
            setupConn(conn);
            showScreen('lobby'); 
        }
    });

    peer.on('connection', setupConn);
}
Â  Â  function setupConn(c) {
Â  Â  Â  Â  if(isHost) connections.push(c);
Â  Â  Â  Â  c.on('open', () => { if(!isHost) c.send({type:'JOIN', name:myName}); });
Â  Â  Â  Â  c.on('data', data => handleData(data, c));
Â  Â  }

function handleData(data, c) {
Â  Â  switch(data.type) {
Â  Â  Â  Â  case 'JOIN':
Â  Â  Â  Â  Â  Â  if(isHost) {
Â  Â  Â  Â  Â  Â  Â  Â  players.push({id:c.peer, name:data.name, hand:[], isFinished:false});
Â  Â  Â  Â  Â  Â  Â  Â  updateLobby();Â 
Â  Â  Â  Â  Â  Â  Â  Â  broadcast({type:'LOBBY', players});
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'LOBBY':Â 
Â  Â  Â  Â  Â  Â  players = data.players;Â 
Â  Â  Â  Â  Â  Â  updateLobby();Â 
Â  Â  Â  Â  Â  Â  showScreen('lobby');Â 
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'START_DRAW_PHASE':
Â  Â  Â  Â  Â  Â  players = data.players;Â 
Â  Â  Â  Â  Â  Â  roleDrawingIdx = 0;
Â  Â  Â  Â  Â  Â  showRoleDrawScreen(players.length);Â 
Â  Â  Â  Â  Â  Â  updateRoleTurnMsg();
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'ROLE_PICKED':Â 
Â  Â  Â  Â  Â  Â  if(isHost) processRolePick(data.cardIdx, c.peer);Â 
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'ROLE_OPEN':
Â  Â  Â  Â  Â  Â  renderOpenedRole(data.cardIdx, data.rank, data.pName);
Â  Â  Â  Â  Â  Â  roleDrawingIdx = data.nextIdx;Â 
Â  Â  Â  Â  Â  Â  updateRoleTurnMsg();
Â  Â  Â  Â  Â  Â  if(data.isAllDone && isHost) setTimeout(finalizeRoles, 1500);
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'TAX_START':Â 
Â  Â  Â  Â  Â  Â  players = data.players;Â 
Â  Â  Â  Â  Â  Â  startTaxPhase();Â 
Â  Â  Â  Â  Â  Â  updateStatusBar();Â 
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'DALMUTI_WAIT':
Â  Â  Â  Â  Â  Â  taxStorage = data.taxCards;
Â  Â  Â  Â  Â  Â  const isDalmuti = (players[0].id === myID);
Â  Â  Â  Â  Â  Â  showScreen('tax-phase');
Â  Â  Â  Â  Â  Â  if(isDalmuti) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('tax-instruction').innerHTML = "ë†ë…¸ì˜ ì¡°ê³µì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤.<br>ì´ì œ í•˜ì‚¬í•  <b>ì¹´ë“œ 2ì¥</b>ì„ ê³ ë¥´ì„¸ìš”.";
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('tax-btn').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  renderHand('tax-hand', players.find(p => p.id === myID).hand, true);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('tax-instruction').innerText = "ë‹¬ë¬´í‹°ê°€ í•˜ì‚¬í’ˆì„ ê³ ë¥´ê³  ìˆìŠµë‹ˆë‹¤...";
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('tax-btn').classList.add('hidden');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'GAME_START':
Â  Â  Â  Â  Â  Â  players = data.players;Â 
Â  Â  Â  Â  Â  Â  currentPlayerIdx = data.turn;Â 
Â  Â  Â  Â  Â  Â  lastPlayed = data.last;
Â  Â  Â  Â  Â  Â  showScreen('game-board');Â 
Â  Â  Â  Â  Â  Â  updateUI();Â 
Â  Â  Â  Â  Â  Â  updateStatusBar();Â 
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'SHOW_RESULT':
Â  Â  Â  Â  Â  Â  players = data.players;
Â  Â  Â  Â  Â  Â  showRoundResult();Â 
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- ğŸš© í•µì‹¬ ìˆ˜ì • êµ¬ê°„ ğŸš© ---
Â  Â case 'PLAY_REQ':Â 
Â  Â  Â  Â  Â  Â  if(isHost) {
Â  Â  Â  Â  Â  Â  Â  Â  const actualIdx = players.findIndex(p => p.id === c.peer);
Â  Â  Â  Â  Â  Â  Â  Â  if (actualIdx !== -1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // â˜… ì„¸ ë²ˆì§¸ ìë¦¬(actualIdx) ë’¤ì— ì‰¼í‘œë¥¼ ì°ê³  data.indicesë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  doPlay(data.rank, data.count, actualIdx, data.indices);Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'PASS_REQ':Â 
Â  Â  Â  Â  Â  Â  if(isHost) doPass();Â 
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'PEON_TAX':Â 
Â  Â  Â  Â  Â  Â  if(isHost) handlePeonTax(data.cards);Â 
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'DAL_TAX_REQ':Â 
Â  Â  Â  Â  Â  Â  if(isHost) handleDalTax(data.cards);Â 
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  // ---------------------------
Â  Â  }
}
Â  Â  function broadcast(data) { connections.forEach(c => c.send(data)); }

Â  Â  function hostStartRoleDraw() {
Â  Â  Â  Â  roleDeck = Array.from({length: 12}, (_, i) => i + 1).sort(() => Math.random() - 0.5);
Â  Â  Â  Â  roleDrawingIdx = 0;
Â  Â  Â  Â  const msg = {type:'START_DRAW_PHASE', players: players};
Â  Â  Â  Â  handleData(msg); broadcast(msg);
Â  Â  }

Â  Â  function processRolePick(cardIdx, pickerID) {
Â  Â  Â  Â  const rank = roleDeck.pop();
Â  Â  Â  Â  const pIdx = players.findIndex(p => p.id === pickerID);
Â  Â  Â  Â  players[pIdx].initRank = rank;
Â  Â  Â  Â  const nextIdx = roleDrawingIdx + 1;
Â  Â  Â  Â  const isAllDone = nextIdx >= players.length;
Â  Â  Â  Â  const msg = {type:'ROLE_OPEN', cardIdx, rank, pName: players[pIdx].name, nextIdx, isAllDone};
Â  Â  Â  Â  handleData(msg); broadcast(msg);
Â  Â  }

Â  Â  function renderOpenedRole(idx, rank, name) {
Â  Â  Â  Â  const card = document.getElementById(`role-card-${idx}`);
Â  Â  Â  Â  if(card) { card.innerText = rank; card.classList.add('disabled'); }
Â  Â  Â  Â  document.getElementById('role-results').innerHTML += `<div class="role-item">ğŸ‘¤ ${name}: <b>${rank}</b></div>`;
Â  Â  }

Â  Â  function showRoleDrawScreen(count) {
Â  Â  Â  Â  showScreen('role-draw');
Â  Â  Â  Â  const container = document.getElementById('role-cards');
Â  Â  Â  Â  container.innerHTML = ''; document.getElementById('role-results').innerHTML = '';
Â  Â  Â  Â  for(let i=0; i<count; i++) {
Â  Â  Â  Â  Â  Â  container.innerHTML += `<div class="card" id="role-card-${i}" onclick="tryPickRole(${i})">?</div>`;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function tryPickRole(cardIdx) {
Â  Â  Â  Â  if(players[roleDrawingIdx].id !== myID) return alert("ìê¸° ì°¨ë¡€ê°€ ì•„ë‹™ë‹ˆë‹¤!");
Â  Â  Â  Â  if(document.getElementById(`role-card-${cardIdx}`).classList.contains('disabled')) return;
Â  Â  Â  Â  if(isHost) processRolePick(cardIdx, myID);
Â  Â  Â  Â  else conn.send({type:'ROLE_PICKED', cardIdx});
Â  Â  }

Â  Â  function updateRoleTurnMsg() {
Â  Â  Â  Â  if (roleDrawingIdx >= players.length) return;
Â  Â  Â  Â  const p = players[roleDrawingIdx];
Â  Â  Â  Â  document.getElementById('role-turn-msg').innerText = (p.id === myID) ? "ğŸ”´ ë‹¹ì‹ ì˜ ì°¨ë¡€! ì¹´ë“œë¥¼ ë½‘ìœ¼ì„¸ìš”." : `âŒ› ${p.name}ë‹˜ì´ ë½‘ëŠ” ì¤‘...`;
Â  Â  }

Â  Â function finalizeRoles() {
Â  Â  Â  Â  // ì´ë¯¸ ê²Œì„ì„ í•œ ë²ˆ í•´ì„œ ì„œì—´ì´ ì •í•´ì§„ ìƒíƒœë¼ë©´ ì •ë ¬ì„ ìƒëµí•˜ê³  ë°”ë¡œ ì¹´ë“œ ë¶„ë°°
Â  Â  Â  Â  // (nextTurnì—ì„œ ì´ë¯¸ players ë°°ì—´ì´ ìˆœìœ„ëŒ€ë¡œ ì •ë ¬ë˜ì—ˆê¸° ë•Œë¬¸)
Â  Â  Â  Â  if (!players[0].role) {
Â  Â  Â  Â  Â  Â  players.sort((a,b) => a.initRank - b.initRank);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  players.forEach((p,i) => {
Â  Â  Â  Â  Â  Â  p.isFinished = false; // ìƒíƒœ ì´ˆê¸°í™”
Â  Â  Â  Â  Â  Â  p.role = i===0?"ğŸ‘‘ ë‹¬ë¬´í‹°":(i===players.length-1?"ğŸ’© ë†ë…¸":`${i+1}ë“± í‰ë¯¼`);
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  dealCards();
Â  Â  }
Â  Â  function dealCards() {
Â  Â  Â  Â  let deck = []; for(let i=1; i<=12; i++) for(let j=0; j<i; j++) deck.push(i);
Â  Â  Â  Â  deck.push(13,13); deck.sort(()=>Math.random()-0.5);
Â  Â  Â  Â  players.forEach(p => { p.hand = []; p.isFinished = false; });
Â  Â  Â  Â  let i=0; while(deck.length) players[i++ % players.length].hand.push(deck.pop());
Â  Â  Â  Â  players.forEach(p => p.hand.sort((a,b)=>a-b));
Â  Â  Â  Â  const msg = {type:'TAX_START', players}; handleData(msg); broadcast(msg);
Â  Â  }

Â  Â  function startTaxPhase() {
Â  Â  Â  Â  showScreen('tax-phase');
Â  Â  Â  Â  const isPeon = (players[players.length-1].id === myID);
Â  Â  Â  Â  const me = players.find(p => p.id === myID);
Â  Â  Â  Â  document.getElementById('tax-btn').classList.toggle('hidden', !isPeon);
Â  Â  Â  Â  if(isPeon) {
Â  Â  Â  Â  Â  Â  document.getElementById('tax-instruction').innerHTML = "<b>ë†ë…¸</b>ë‹˜, ê°€ì¥ ì¢‹ì€ ì¹´ë“œ 2ì¥ì„ ë‚´ì„¸ìš”.";
Â  Â  Â  Â  Â  Â  renderHand('tax-hand', me.hand, true);
Â  Â  Â  Â  } else { document.getElementById('tax-instruction').innerText = "ë†ë…¸ì˜ ì„¸ê¸ˆì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."; }
Â  Â  }
function submitTax() {
Â  Â  Â  Â  if(selectedCards.length !== 2) return alert("2ì¥ì„ ê³ ë¥´ì„¸ìš”.");
Â  Â  Â  Â Â 
Â  Â  Â  Â  const isPeon = (players[players.length - 1].id === myID); // ë‚´ê°€ ë†ë…¸ì¸ì§€ í™•ì¸
Â  Â  Â  Â  const isDalmuti = (players[0].id === myID); // ë‚´ê°€ ë‹¬ë¬´í‹°ì¸ì§€ í™•ì¸

Â  Â  Â  Â  if(isPeon) {Â 
Â  Â  Â  Â  Â  Â  // 1. ë†ë…¸ ê²€ì¦ ë¡œì§
Â  Â  Â  Â  Â  Â  const pIdx = players.findIndex(p => p.id === myID);
Â  Â  Â  Â  Â  Â  const best = [...players[pIdx].hand].sort((a,b)=>a-b).slice(0,2);
Â  Â  Â  Â  Â  Â  const mine = selectedCards.map(s=>s.rank).sort((a,b)=>a-b);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(mine[0]!==best[0] || mine[1]!==best[1]) {
Â  Â  Â  Â  Â  Â  Â  Â  return alert(`ë†ë…¸ ë„¤ ì´ë†ˆ! (${best[0]}, ${best[1]}ë²ˆ ì¹´ë“œë¥¼ ë‚´ì•¼ í•¨)`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ë†ë…¸ê°€ ë°©ì¥ì´ë©´ ì§ì ‘ ì²˜ë¦¬, ì°¸ì—¬ìë©´ ë°©ì¥ì—ê²Œ ì „ì†¡
Â  Â  Â  Â  Â  Â  if(isHost) handlePeonTax(selectedCards);Â 
Â  Â  Â  Â  Â  Â  else conn.send({type:'PEON_TAX', cards:selectedCards});

Â  Â  Â  Â  } else if(isDalmuti) {
Â  Â  Â  Â  Â  Â  // 2. ë‹¬ë¬´í‹° í•˜ì‚¬ ë¡œì§ (ì´ ë¶€ë¶„ì´ ìˆ˜ì •ë˜ì–´ì•¼ í•¨)
Â  Â  Â  Â  Â  Â  if(isHost) {
Â  Â  Â  Â  Â  Â  Â  Â  // ë‹¬ë¬´í‹°ê°€ ë°©ì¥ì¸ ê²½ìš° ì§ì ‘ ì‹¤í–‰
Â  Â  Â  Â  Â  Â  Â  Â  handleDalTax(selectedCards);Â 
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // ë‹¬ë¬´í‹°ê°€ ì°¸ì—¬ìì¸ ê²½ìš° ë°©ì¥ì—ê²Œ í•˜ì‚¬í’ˆ ì •ë³´ë¥¼ ë³´ëƒ„
Â  Â  Â  Â  Â  Â  Â  Â  conn.send({type:'DAL_TAX_REQ', cards:selectedCards});
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  // [ë°©ì¥ ì „ìš©] ë†ë…¸ì˜ ì¡°ê³µì„ ì²˜ë¦¬í•˜ê³  ë‹¬ë¬´í‹°ì—ê²Œ í„´ì„ ë„˜ê¹ë‹ˆë‹¤.
Â  Â  function handlePeonTax(selectedIndices) {
Â  Â  Â  Â  const peon = players[players.length - 1];
Â  Â  Â  Â  taxStorage = [];
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ì¸ë±ìŠ¤ë¥¼ í° ìˆœì„œëŒ€ë¡œ ì •ë ¬í•˜ì—¬ ì›ë³¸ ë°°ì—´ ì œê±° ì‹œ ì¸ë±ìŠ¤ ê¼¬ì„ ë°©ì§€
Â  Â  Â  Â  selectedIndices.sort((a, b) => b.idx - a.idx).forEach(c => {
Â  Â  Â  Â  Â  Â  taxStorage.push(peon.hand.splice(c.idx, 1)[0]);
Â  Â  Â  Â  });

Â  Â  Â  Â  // ì¤‘ìš”: ë°©ì¥ ë³¸ì¸ í™”ë©´ì„ ì—…ë°ì´íŠ¸í•˜ê³ , ëª¨ë“  ì°¸ì—¬ìì—ê²Œë„ 'ë‹¬ë¬´í‹° ì°¨ë¡€'ì„ì„ ì•Œë¦½ë‹ˆë‹¤.
Â  Â  Â  Â  const msg = { type: 'DALMUTI_WAIT', taxCards: taxStorage };
Â  Â  Â  Â  handleData(msg);Â 
Â  Â  Â  Â  broadcast(msg);Â 
Â  Â  }
// [ë°©ì¥ ì „ìš©] ë‹¬ë¬´í‹°ê°€ í•˜ì‚¬í•œ ì¹´ë“œë¥¼ ì²˜ë¦¬í•˜ê³  ê²Œì„ì„ ì§„ì§œë¡œ ì‹œì‘í•©ë‹ˆë‹¤.
Â  Â  function handleDalTax(cards) {
Â  Â  Â  Â  if (!isHost) return; // ë°©ì¥ë§Œ ì‹¤í–‰í•˜ëŠ” ë¡œì§ì…ë‹ˆë‹¤.

Â  Â  Â  Â  const dal = players[0];
Â  Â  Â  Â  const peon = players[players.length - 1];

Â  Â  Â  Â  // 1. ë‹¬ë¬´í‹°ì˜ ì†íŒ¨ì—ì„œ ì„ íƒí•œ ì¹´ë“œ ì œê±° í›„ ë†ë…¸ì—ê²Œ ì „ë‹¬
Â  Â  Â  Â  // ì¸ë±ìŠ¤ ê¼¬ì„ ë°©ì§€ë¥¼ ìœ„í•´ ë’¤ì—ì„œë¶€í„° ì œê±°í•©ë‹ˆë‹¤.
Â  Â  Â  Â  cards.sort((a, b) => b.idx - a.idx).forEach(c => {
Â  Â  Â  Â  Â  Â  peon.hand.push(dal.hand.splice(c.idx, 1)[0]);
Â  Â  Â  Â  });

Â  Â  Â  Â  // 2. ë†ë…¸ê°€ ì•„ê¹Œ ë°”ì³¤ë˜ ì¡°ê³µ(taxStorage)ì„ ë‹¬ë¬´í‹°ì˜ ì†íŒ¨ì— ì¶”ê°€
Â  Â  Â  Â  dal.hand.push(...taxStorage);

Â  Â  Â  Â  // 3. ëª¨ë“  í”Œë ˆì´ì–´ì˜ ì†íŒ¨ë¥¼ ë‹¤ì‹œ ìˆ«ì ìˆœì„œëŒ€ë¡œ ì •ë ¬
Â  Â  Â  Â  players.forEach(p => p.hand.sort((a, b) => a - b));

Â  Â  Â  Â  // 4. ëª¨ë“  ì°¸ì—¬ìì—ê²Œ "ì´ì œ ê²Œì„ ì‹œì‘ì´ë‹¤!"ë¼ê³  ì‹ í˜¸ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.
Â  Â  Â  Â  const msg = {
Â  Â  Â  Â  Â  Â  type: 'GAME_START',
Â  Â  Â  Â  Â  Â  players: players,
Â  Â  Â  Â  Â  Â  turn: 0, // ë‹¬ë¬´í‹°(ë°©ì¥)ë¶€í„° ì‹œì‘
Â  Â  Â  Â  Â  Â  last: { rank: 14, count: 0 }
Â  Â  Â  Â  };

Â  Â  Â  Â  handleData(msg); // ë°©ì¥ ë³¸ì¸ í™”ë©´ì„ ê²Œì„íŒìœ¼ë¡œ ì „í™˜
Â  Â  Â  Â  broadcast(msg);Â  // ì°¸ì—¬ì(ë†ë…¸ ë“±)ì˜ í™”ë©´ì„ ê²Œì„íŒìœ¼ë¡œ ê°•ì œ ì „í™˜
Â  Â  }
Â  Â  // [í‘œì‹œ ì „ìš©] ìƒë‹¨ì— ë‹¬ë¬´í‹°ì™€ ë†ë…¸ ì •ë³´ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.
Â  Â  function updateStatusBar() {
Â  Â  Â  Â  if (players.length < 2) return;
Â  Â  Â  Â  const dalmuti = players[0];
Â  Â  Â  Â  const peon = players[players.length - 1];
Â  Â  Â  Â  const statusEl = document.getElementById('status-bar');
Â  Â  Â  Â Â 
Â  Â  Â  Â  statusEl.innerHTML = `
Â  Â  Â  Â  Â  Â  <span style="color:var(--accent)">ğŸ‘‘ ${dalmuti.name}(${dalmuti.hand.length})</span> |Â 
Â  Â  Â  Â  Â  Â  <span style="color:#bdc3c7">ğŸ’© ${peon.name}(${peon.hand.length})</span>
Â  Â  Â  Â  `;
Â  Â  }

  // ìˆ«ì -> ì¼ë³¸ì–´ ì½ê¸° ë³€í™˜ í•¨ìˆ˜
function getJapaneseRank(rank) {
    if (rank === 13) return 'J'; // ë°ì´í„°ê°€ 13ì´ë©´ í™”ë©´ì—” J
    const counts = {
        1: "ã²ã¨ã¤", 2: "ãµãŸã¤", 3: "ã¿ã£ã¤", 4: "ã‚ˆã£ã¤", 5: "ã„ã¤ã¤",
        6: "ã‚€ã£ã¤", 7: "ãªãªã¤", 8: "ã‚„ã£ã¤", 9: "ã“ã“ã®ã¤", 10: "ã¨ãŠ",
        11: "ã˜ã‚…ã†ã„ã£ã“", 12: "ã˜ã‚…ã†ã«ã“"
    };
    return counts[rank] || rank;
}
Â  Â  function updateUI() {
Â  Â  Â  Â  const me = players.find(p => p.id === myID);
Â  Â  Â  Â  const isMyTurn = players[currentPlayerIdx].id === myID;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // [ìˆ˜ì •] ë°”ë‹¥ì´ ì²­ì†Œë˜ì—ˆì„ ë•Œ ë¬¸êµ¬ ê°•ì¡°
Â  Â  Â  Â  let turnMsg = isMyTurn ? "ğŸ”´ ë‚´ ì°¨ë¡€!" : `âŒ› ${players[currentPlayerIdx].name} ì°¨ë¡€`;
Â  Â  Â  Â  if (isMyTurn && lastPlayed.count === 0) {
Â  Â  Â  Â  Â  Â  turnMsg = "âœ¨ ë°”ë‹¥ ì²­ì†Œë¨! ì›í•˜ëŠ” ì¹´ë“œë¥¼ ë‚´ì„¸ìš”! âœ¨";
Â  Â  Â  Â  }
Â  Â  Â  Â  document.getElementById('turn-display').innerText = turnMsg;

Â  Â  Â  Â  // ìƒë‹¨ í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ ë° ì¹´ë“œ ìˆ˜
Â  Â  Â  Â  document.getElementById('rank-board').innerHTML = players.map(p =>Â 
Â  Â  Â  Â  Â  Â  `<span class="rank-badge">${p.name}(${p.hand.length})</span>`
Â  Â  Â  Â  ).join('');

Â  Â  Â  Â  // ë‚´ ì†íŒ¨ ê·¸ë¦¬ê¸°
Â  Â  Â  Â  renderHand('my-hand', me.hand, isMyTurn);

Â  Â  Â  Â  // [ìˆ˜ì •] í…Œì´ë¸” ì¤‘ì•™ ì¹´ë“œ ì˜ì—­ í‘œì‹œ
Â  Â  Â  Â  const table = document.getElementById('table-cards');Â 
Â  Â  Â  Â  table.innerHTML = '';
Â  Â  Â  Â  if(lastPlayed.count > 0) {
Â  Â  Â  Â  Â  Â  for(let i=0; i<lastPlayed.count; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  table.innerHTML += `<div class="card">${getJapaneseRank(lastPlayed.rank)}</div>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // ë°”ë‹¥ì´ ë¹„ì—ˆì„ ë•Œ ì‹œê°ì  ì•ˆë‚´ ì¶”ê°€
Â  Â  Â  Â  Â  Â  table.innerHTML = `<div style="color:#aaa; font-style:italic; margin-top:40px;">ğŸ§¹ ë°”ë‹¥ì´ ì²­ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.</div>`;
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  function renderHand(cid, hand, active) {
Â  Â  Â  Â  const cont = document.getElementById(cid); cont.innerHTML = '';
Â  Â  Â  Â  hand.forEach((r, i) => {
Â  Â  Â  Â  Â  Â  const c = document.createElement('div'); c.className = 'card'; c.innerText = getJapaneseRank(r);
Â  Â  Â  Â  Â  Â  c.onclick = () => { if(active) { c.classList.toggle('selected'); const si = selectedCards.findIndex(s=>s.idx===i); if(si>-1) selectedCards.splice(si,1); else selectedCards.push({rank:r, idx:i}); }};
Â  Â  Â  Â  Â  Â  cont.appendChild(c);
Â  Â  Â  Â  });
Â  Â  }

function playCards() {
Â  Â  if(!selectedCards.length) return;

Â  Â  // 1. ì¡°ì»¤(13)ë¥¼ ì œì™¸í•œ ì¼ë°˜ ì¹´ë“œë“¤ë§Œ ì¶”ì¶œ
Â  Â  const nonJokerCards = selectedCards.filter(c => c.rank !== 13);
Â  Â Â 
Â  Â  // ì¡°ì»¤ë§Œ ë‹¨ë…ìœ¼ë¡œ ë‚¼ ìˆ˜ ì—†ìŒ
Â  Â  if (nonJokerCards.length === 0) {
Â  Â  Â  Â  alert("ì¡°ì»¤ëŠ” ë‹¨ë…ìœ¼ë¡œ ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
Â  Â  Â  Â  resetSelection();
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // 2. ë³€ì‹ í•  ìˆ«ìì™€ ì „ì²´ ì¥ìˆ˜ ê³„ì‚°
Â  Â  const effectiveRank = nonJokerCards[0].rank;
Â  Â  const totalCount = selectedCards.length;Â 

Â  Â  // 3. ì„œë¡œ ë‹¤ë¥¸ ìˆ«ìê°€ ì„ì—¬ìˆëŠ”ì§€ í™•ì¸
Â  Â  if (!nonJokerCards.every(c => c.rank === effectiveRank)) {
Â  Â  Â  Â  alert("ì„œë¡œ ë‹¤ë¥¸ ìˆ«ìì˜ ì¹´ë“œëŠ” í•¨ê»˜ ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤! ì„ íƒì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.");
Â  Â  Â  Â  resetSelection();
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // 4. ë°”ë‹¥ ì¹´ë“œì™€ ë¹„êµ
Â  Â  if(lastPlayed.count > 0) {
Â  Â  Â  Â  if(totalCount !== lastPlayed.count || effectiveRank >= lastPlayed.rank) {
Â  Â  Â  Â  Â  Â  alert(`${lastPlayed.count}ì¥ìœ¼ë¡œ ${lastPlayed.rank}ë³´ë‹¤ ë‚®ì€ ìˆ«ìë¥¼ ë‚´ì•¼ í•©ë‹ˆë‹¤.`);
Â  Â  Â  Â  Â  Â  resetSelection();
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // 5. ì„œë²„ ì „ì†¡ ë° ë¡œì»¬ ì„ íƒ ë¹„ìš°ê¸°
    const myIdx = players.findIndex(p => p.id === myID);
    const cardIndices = selectedCards.map(s => s.idx);

    if(isHost) {
        doPlay(effectiveRank, totalCount, myIdx); // ë°©ì¥ì€ ë³¸ì¸ ì¸ë±ìŠ¤ë¥¼ ì§ì ‘ ì „ë‹¬
        resetSelection(); 
    } else {
        conn.send({
            type: 'PLAY_REQ', 
            rank: effectiveRank, 
            count: totalCount, 
            pIdx: myIdx,      // â˜… ë°©ì¥ì´ ëˆ„êµ¬ì˜ ì¹´ë“œë¥¼ ì§€ìš¸ì§€ ì•Œê¸° ìœ„í•´ ë°˜ë“œì‹œ í•„ìš”!
            indices: cardIndices 
        });
        
        selectedCards = []; 
        resetSelection(); 
    }
function resetSelection() {
Â  Â  selectedCards = []; // ë°ì´í„° ë¹„ìš°ê¸°
Â  Â  const cards = document.querySelectorAll('.card');
Â  Â  cards.forEach(c => c.classList.remove('selected')); // í™”ë©´ì—ì„œ ì£¼í™©ìƒ‰ í…Œë‘ë¦¬ ì œê±°
}

Â function doPlay(rank, count, pIdx, indices) { // â† ì—¬ê¸°ì— indices ì¶”ê°€ë¨
Â  Â  lastPlayed = {rank, count};

Â  Â  // 1. ì§€ìš¸ ì¹´ë“œì˜ ë²ˆí˜¸(ì¸ë±ìŠ¤) ê²°ì •
Â  Â  // indicesê°€ ìˆìœ¼ë©´ ê·¸ê±¸ ì“°ê³ (ì°¸ê°€ì), ì—†ìœ¼ë©´ selectedCardsë¥¼ ì”ë‹ˆë‹¤(ë°©ì¥).
Â  Â  const targetIndices = (indices || selectedCards.map(s => s.idx)).sort((a, b) => b - a);
Â  Â Â 
Â  Â  // 2. ì‹¤ì œ ì†íŒ¨ì—ì„œ ì¹´ë“œ ì œê±°
Â  Â  targetIndices.forEach(idx => {
Â  Â  Â  Â  if(players[pIdx].hand[idx] !== undefined) {
Â  Â  Â  Â  Â  Â  players[pIdx].hand.splice(idx, 1);
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // âœ¨ ì„ íƒëœ ëª©ë¡ ë¹„ìš°ê¸° (ë°©ì¥ ì „ìš©)
Â  Â  selectedCards = [];Â 
Â  Â Â 
Â  Â  // 3. íƒˆì¶œ ì²˜ë¦¬
Â  Â  if(players[pIdx].hand.length === 0 && !players[pIdx].isFinished) {
Â  Â  Â  Â  players[pIdx].isFinished = true;
Â  Â  Â  Â  finishOrder.push(players[pIdx]);
Â  Â  Â  Â  alert(`ğŸŠ ${players[pIdx].name}ë‹˜ ${finishOrder.length}ë“±ìœ¼ë¡œ íƒˆì¶œ! ğŸŠ`);
Â  Â  }
Â  Â Â 
Â  Â  passCount = 0;Â 
Â  Â  nextTurn();
}
Â  Â  function nextTurn() {
Â  Â  Â  Â  const activePlayers = players.filter(p => !p.isFinished);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (activePlayers.length <= 1) {
Â  Â  Â  Â  Â  Â  if (activePlayers.length === 1) {
Â  Â  Â  Â  Â  Â  Â  Â  activePlayers[0].isFinished = true;
Â  Â  Â  Â  Â  Â  Â  Â  finishOrder.push(activePlayers[0]);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // íƒˆì¶œ ìˆœì„œëŒ€ë¡œ í”Œë ˆì´ì–´ ì¬ë°°ì¹˜ ë° ì‹ ë¶„ ë¶€ì—¬
Â  Â  Â  Â  Â  Â  players = [...finishOrder];Â 
Â  Â  Â  Â  Â  Â  players.forEach((p, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (i === 0) p.role = "ğŸ‘‘ ë‹¬ë¬´í‹°";
Â  Â  Â  Â  Â  Â  Â  Â  else if (i === players.length - 1) p.role = "ğŸ’© ë†ë…¸";
Â  Â  Â  Â  Â  Â  Â  Â  else p.role = `${i+1}ë“± í‰ë¯¼`;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const msg = { type: 'SHOW_RESULT', players: players };
Â  Â  Â  Â  Â  Â  finishOrder = []; // ë‹¤ìŒ íŒì„ ìœ„í•´ ì´ˆê¸°í™”
Â  Â  Â  Â  Â  Â  handleData(msg);
Â  Â  Â  Â  Â  Â  broadcast(msg);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  do {Â 
Â  Â  Â  Â  Â  Â  currentPlayerIdx = (currentPlayerIdx + 1) % players.length;Â 
Â  Â  Â  Â  } while(players[currentPlayerIdx].isFinished);

Â  Â  Â  Â  const msg = {type:'GAME_START', players, turn:currentPlayerIdx, last:lastPlayed};Â 
Â  Â  Â  Â  handleData(msg);Â 
Â  Â  Â  Â  broadcast(msg);
Â  Â  }
Â  Â  // ê²°ê³¼ í™”ë©´ì„ ì‹¤ì œë¡œ ê·¸ë ¤ì£¼ëŠ” í•¨ìˆ˜
Â  Â  function showRoundResult() {
Â  Â  Â  Â  showScreen('round-result-screen');
Â  Â  Â  Â  const listDiv = document.getElementById('final-ranking-list');
Â  Â  Â  Â  listDiv.innerHTML = players.map((p, i) => {
Â  Â  Â  Â  Â  Â  let cls = (i === 0) ? 'badge-dalmuti' : (i === players.length - 1 ? 'badge-peon' : 'badge-common');
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="role-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="rank-badge ${cls}">${i + 1}ìœ„</span>:Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <b>${p.name}</b> <span style="font-size:0.8rem; color:#aaa;">(${p.role})</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }).join('');
Â  Â  }

Â  Â  // í™”ë©´ ì „í™˜ í•¨ìˆ˜ (ê¸°ì¡´ ì½”ë“œì— ì—†ì„ ê²½ìš° ëŒ€ë¹„)
function showScreen(id) { 
    // 1. ëª¨ë“  ìŠ¤í¬ë¦°ì„ ìˆ¨ê¹€
    document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden')); 
    
    // 2. ëŒ€ìƒ IDê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ í›„ ë³´ì—¬ì¤Œ
    const target = document.getElementById(id);
    if (target) {
        target.classList.remove('hidden');
    } else {
        console.error("í™”ë©´ ì „í™˜ ì˜¤ë¥˜: '" + id + "'ë¼ëŠ” IDë¥¼ ê°€ì§„ ì—˜ë¦¬ë¨¼íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.");
    }
}

    function doPass() {Â 
Â  Â  const activePlayers = players.filter(p => !p.isFinished).length;
Â  Â  passCount++;Â 
Â  Â Â 
Â  Â  // ë‚˜ë¥¼ ì œì™¸í•œ ëª¨ë“  ì‚¬ëŒì´ íŒ¨ìŠ¤í•˜ë©´ ë°”ë‹¥ ì²­ì†Œ
Â  Â  if(passCount >= activePlayers - 1) {Â 
Â  Â  Â  Â  lastPlayed = { rank: 14, count: 0 };
Â  Â  Â  Â  passCount = 0;
Â  Â  }
Â  Â Â 
Â  Â  nextTurn();Â 
}
function passTurn() {
    const isMyTurn = players[currentPlayerIdx].id === myID;
    if (!isMyTurn) return alert("ë‹¹ì‹  ì°¨ë¡€ê°€ ì•„ë‹™ë‹ˆë‹¤!");

    if (isHost) {
        doPass();
    } else {
        conn.send({ type: 'PASS_REQ' });
    }
}

</script>
</body>
</html>

